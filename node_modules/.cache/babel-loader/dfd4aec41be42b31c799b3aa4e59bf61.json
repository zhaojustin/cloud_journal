{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\n\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\n\nvar package_version_1 = __importDefault(require(\"./package_version\"));\n\nvar fetch_1 = __importDefault(require(\"./fetch\"));\n\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\n\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\n\nfunction runAction(base, method, path, queryParams, bodyData, callback, numAttempts) {\n  var url = base._airtable._endpointUrl + \"/v\" + base._airtable._apiVersionMajor + \"/\" + base._id + path + \"?\" + object_to_query_param_string_1.default(queryParams);\n  var headers = {\n    authorization: \"Bearer \" + base._airtable._apiKey,\n    'x-api-version': base._airtable._apiVersion,\n    'x-airtable-application-id': base.getId(),\n    'content-type': 'application/json'\n  };\n  var isBrowser = typeof window !== 'undefined'; // Some browsers do not allow overriding the user agent.\n  // https://github.com/Airtable/airtable.js/issues/52\n\n  if (isBrowser) {\n    headers['x-airtable-user-agent'] = userAgent;\n  } else {\n    headers['User-Agent'] = userAgent;\n  }\n\n  var controller = new abort_controller_1.default();\n  var normalizedMethod = method.toUpperCase();\n  var options = {\n    method: normalizedMethod,\n    headers: headers,\n    signal: controller.signal\n  };\n\n  if (bodyData !== null) {\n    if (normalizedMethod === 'GET' || normalizedMethod === 'HEAD') {\n      console.warn('body argument to runAction are ignored with GET or HEAD requests');\n    } else {\n      options.body = JSON.stringify(bodyData);\n    }\n  }\n\n  var timeout = setTimeout(function () {\n    controller.abort();\n  }, base._airtable._requestTimeout);\n  fetch_1.default(url, options).then(function (resp) {\n    clearTimeout(timeout);\n\n    if (resp.status === 429 && !base._airtable._noRetryIfRateLimited) {\n      var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts);\n      setTimeout(function () {\n        runAction(base, method, path, queryParams, bodyData, callback, numAttempts + 1);\n      }, backoffDelayMs);\n    } else {\n      resp.json().then(function (body) {\n        var error = base._checkStatusForError(resp.status, body); // Ensure Response interface matches interface from\n        // `request` Response object\n\n\n        var r = {};\n        Object.keys(resp).forEach(function (property) {\n          r[property] = resp[property];\n        });\n        r.body = body;\n        r.statusCode = resp.status;\n        callback(error, r, body);\n      }).catch(function () {\n        callback(base._checkStatusForError(resp.status));\n      });\n    }\n  }).catch(function (error) {\n    clearTimeout(timeout);\n    callback(error);\n  });\n}\n\nmodule.exports = runAction;","map":{"version":3,"sources":["../src/run_action.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\nvar package_version_1 = __importDefault(require(\"./package_version\"));\nvar fetch_1 = __importDefault(require(\"./fetch\"));\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\nfunction runAction(base, method, path, queryParams, bodyData, callback, numAttempts) {\n    var url = base._airtable._endpointUrl + \"/v\" + base._airtable._apiVersionMajor + \"/\" + base._id + path + \"?\" + object_to_query_param_string_1.default(queryParams);\n    var headers = {\n        authorization: \"Bearer \" + base._airtable._apiKey,\n        'x-api-version': base._airtable._apiVersion,\n        'x-airtable-application-id': base.getId(),\n        'content-type': 'application/json',\n    };\n    var isBrowser = typeof window !== 'undefined';\n    // Some browsers do not allow overriding the user agent.\n    // https://github.com/Airtable/airtable.js/issues/52\n    if (isBrowser) {\n        headers['x-airtable-user-agent'] = userAgent;\n    }\n    else {\n        headers['User-Agent'] = userAgent;\n    }\n    var controller = new abort_controller_1.default();\n    var normalizedMethod = method.toUpperCase();\n    var options = {\n        method: normalizedMethod,\n        headers: headers,\n        signal: controller.signal,\n    };\n    if (bodyData !== null) {\n        if (normalizedMethod === 'GET' || normalizedMethod === 'HEAD') {\n            console.warn('body argument to runAction are ignored with GET or HEAD requests');\n        }\n        else {\n            options.body = JSON.stringify(bodyData);\n        }\n    }\n    var timeout = setTimeout(function () {\n        controller.abort();\n    }, base._airtable._requestTimeout);\n    fetch_1.default(url, options)\n        .then(function (resp) {\n        clearTimeout(timeout);\n        if (resp.status === 429 && !base._airtable._noRetryIfRateLimited) {\n            var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts);\n            setTimeout(function () {\n                runAction(base, method, path, queryParams, bodyData, callback, numAttempts + 1);\n            }, backoffDelayMs);\n        }\n        else {\n            resp.json()\n                .then(function (body) {\n                var error = base._checkStatusForError(resp.status, body);\n                // Ensure Response interface matches interface from\n                // `request` Response object\n                var r = {};\n                Object.keys(resp).forEach(function (property) {\n                    r[property] = resp[property];\n                });\n                r.body = body;\n                r.statusCode = resp.status;\n                callback(error, r, body);\n            })\n                .catch(function () {\n                callback(base._checkStatusForError(resp.status));\n            });\n        }\n    })\n        .catch(function (error) {\n        clearTimeout(timeout);\n        callback(error);\n    });\n}\nmodule.exports = runAction;\n"]},"metadata":{},"sourceType":"script"}