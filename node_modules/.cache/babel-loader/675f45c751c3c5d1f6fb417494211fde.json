{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar get_1 = __importDefault(require(\"lodash/get\"));\n\nvar isPlainObject_1 = __importDefault(require(\"lodash/isPlainObject\"));\n\nvar keys_1 = __importDefault(require(\"lodash/keys\"));\n\nvar fetch_1 = __importDefault(require(\"./fetch\"));\n\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\n\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\n\nvar airtable_error_1 = __importDefault(require(\"./airtable_error\"));\n\nvar table_1 = __importDefault(require(\"./table\"));\n\nvar http_headers_1 = __importDefault(require(\"./http_headers\"));\n\nvar run_action_1 = __importDefault(require(\"./run_action\"));\n\nvar package_version_1 = __importDefault(require(\"./package_version\"));\n\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\n\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\n\nvar Base =\n/** @class */\nfunction () {\n  function Base(airtable, baseId) {\n    this._airtable = airtable;\n    this._id = baseId;\n  }\n\n  Base.prototype.table = function (tableName) {\n    return new table_1.default(this, null, tableName);\n  };\n\n  Base.prototype.makeRequest = function (options) {\n    var _this = this;\n\n    var _a;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var method = get_1.default(options, 'method', 'GET').toUpperCase();\n    var url = this._airtable._endpointUrl + \"/v\" + this._airtable._apiVersionMajor + \"/\" + this._id + get_1.default(options, 'path', '/') + \"?\" + object_to_query_param_string_1.default(get_1.default(options, 'qs', {}));\n    var controller = new abort_controller_1.default();\n\n    var headers = this._getRequestHeaders(Object.assign({}, this._airtable._customHeaders, (_a = options.headers) !== null && _a !== void 0 ? _a : {}));\n\n    var requestOptions = {\n      method: method,\n      headers: headers,\n      signal: controller.signal\n    };\n\n    if ('body' in options && _canRequestMethodIncludeBody(method)) {\n      requestOptions.body = JSON.stringify(options.body);\n    }\n\n    var timeout = setTimeout(function () {\n      controller.abort();\n    }, this._airtable._requestTimeout);\n    return new Promise(function (resolve, reject) {\n      fetch_1.default(url, requestOptions).then(function (resp) {\n        clearTimeout(timeout);\n\n        if (resp.status === 429 && !_this._airtable._noRetryIfRateLimited) {\n          var numAttempts_1 = get_1.default(options, '_numAttempts', 0);\n          var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts_1);\n          setTimeout(function () {\n            var newOptions = __assign(__assign({}, options), {\n              _numAttempts: numAttempts_1 + 1\n            });\n\n            _this.makeRequest(newOptions).then(resolve).catch(reject);\n          }, backoffDelayMs);\n        } else {\n          resp.json().then(function (body) {\n            var err = _this._checkStatusForError(resp.status, body) || _getErrorForNonObjectBody(resp.status, body);\n\n            if (err) {\n              reject(err);\n            } else {\n              resolve({\n                statusCode: resp.status,\n                headers: resp.headers,\n                body: body\n              });\n            }\n          }).catch(function () {\n            var err = _getErrorForNonObjectBody(resp.status);\n\n            reject(err);\n          });\n        }\n      }).catch(function (err) {\n        clearTimeout(timeout);\n        err = new airtable_error_1.default('CONNECTION_ERROR', err.message, null);\n        reject(err);\n      });\n    });\n  };\n  /**\n   * @deprecated This method is deprecated.\n   */\n\n\n  Base.prototype.runAction = function (method, path, queryParams, bodyData, callback) {\n    run_action_1.default(this, method, path, queryParams, bodyData, callback, 0);\n  };\n\n  Base.prototype._getRequestHeaders = function (headers) {\n    var result = new http_headers_1.default();\n    result.set('Authorization', \"Bearer \" + this._airtable._apiKey);\n    result.set('User-Agent', userAgent);\n    result.set('Content-Type', 'application/json');\n\n    for (var _i = 0, _a = keys_1.default(headers); _i < _a.length; _i++) {\n      var headerKey = _a[_i];\n      result.set(headerKey, headers[headerKey]);\n    }\n\n    return result.toJSON();\n  };\n\n  Base.prototype._checkStatusForError = function (statusCode, body) {\n    var _a = (body !== null && body !== void 0 ? body : {\n      error: {}\n    }).error,\n        error = _a === void 0 ? {} : _a;\n    var type = error.type,\n        message = error.message;\n\n    if (statusCode === 401) {\n      return new airtable_error_1.default('AUTHENTICATION_REQUIRED', 'You should provide valid api key to perform this operation', statusCode);\n    } else if (statusCode === 403) {\n      return new airtable_error_1.default('NOT_AUTHORIZED', 'You are not authorized to perform this operation', statusCode);\n    } else if (statusCode === 404) {\n      return new airtable_error_1.default('NOT_FOUND', message !== null && message !== void 0 ? message : 'Could not find what you are looking for', statusCode);\n    } else if (statusCode === 413) {\n      return new airtable_error_1.default('REQUEST_TOO_LARGE', 'Request body is too large', statusCode);\n    } else if (statusCode === 422) {\n      return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNPROCESSABLE_ENTITY', message !== null && message !== void 0 ? message : 'The operation cannot be processed', statusCode);\n    } else if (statusCode === 429) {\n      return new airtable_error_1.default('TOO_MANY_REQUESTS', 'You have made too many requests in a short period of time. Please retry your request later', statusCode);\n    } else if (statusCode === 500) {\n      return new airtable_error_1.default('SERVER_ERROR', 'Try again. If the problem persists, contact support.', statusCode);\n    } else if (statusCode === 503) {\n      return new airtable_error_1.default('SERVICE_UNAVAILABLE', 'The service is temporarily unavailable. Please retry shortly.', statusCode);\n    } else if (statusCode >= 400) {\n      return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNEXPECTED_ERROR', message !== null && message !== void 0 ? message : 'An unexpected error occurred', statusCode);\n    } else {\n      return null;\n    }\n  };\n\n  Base.prototype.doCall = function (tableName) {\n    return this.table(tableName);\n  };\n\n  Base.prototype.getId = function () {\n    return this._id;\n  };\n\n  Base.createFunctor = function (airtable, baseId) {\n    var base = new Base(airtable, baseId);\n\n    var baseFn = function (tableName) {\n      return base.doCall(tableName);\n    };\n\n    baseFn._base = base;\n    baseFn.table = base.table.bind(base);\n    baseFn.makeRequest = base.makeRequest.bind(base);\n    baseFn.runAction = base.runAction.bind(base);\n    baseFn.getId = base.getId.bind(base);\n    return baseFn;\n  };\n\n  return Base;\n}();\n\nfunction _canRequestMethodIncludeBody(method) {\n  return method !== 'GET' && method !== 'DELETE';\n}\n\nfunction _getErrorForNonObjectBody(statusCode, body) {\n  if (isPlainObject_1.default(body)) {\n    return null;\n  } else {\n    return new airtable_error_1.default('UNEXPECTED_ERROR', 'The response from Airtable was invalid JSON. Please try again soon.', statusCode);\n  }\n}\n\nmodule.exports = Base;","map":{"version":3,"sources":["../src/base.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar get_1 = __importDefault(require(\"lodash/get\"));\nvar isPlainObject_1 = __importDefault(require(\"lodash/isPlainObject\"));\nvar keys_1 = __importDefault(require(\"lodash/keys\"));\nvar fetch_1 = __importDefault(require(\"./fetch\"));\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\nvar airtable_error_1 = __importDefault(require(\"./airtable_error\"));\nvar table_1 = __importDefault(require(\"./table\"));\nvar http_headers_1 = __importDefault(require(\"./http_headers\"));\nvar run_action_1 = __importDefault(require(\"./run_action\"));\nvar package_version_1 = __importDefault(require(\"./package_version\"));\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\nvar Base = /** @class */ (function () {\n    function Base(airtable, baseId) {\n        this._airtable = airtable;\n        this._id = baseId;\n    }\n    Base.prototype.table = function (tableName) {\n        return new table_1.default(this, null, tableName);\n    };\n    Base.prototype.makeRequest = function (options) {\n        var _this = this;\n        var _a;\n        if (options === void 0) { options = {}; }\n        var method = get_1.default(options, 'method', 'GET').toUpperCase();\n        var url = this._airtable._endpointUrl + \"/v\" + this._airtable._apiVersionMajor + \"/\" + this._id + get_1.default(options, 'path', '/') + \"?\" + object_to_query_param_string_1.default(get_1.default(options, 'qs', {}));\n        var controller = new abort_controller_1.default();\n        var headers = this._getRequestHeaders(Object.assign({}, this._airtable._customHeaders, (_a = options.headers) !== null && _a !== void 0 ? _a : {}));\n        var requestOptions = {\n            method: method,\n            headers: headers,\n            signal: controller.signal,\n        };\n        if ('body' in options && _canRequestMethodIncludeBody(method)) {\n            requestOptions.body = JSON.stringify(options.body);\n        }\n        var timeout = setTimeout(function () {\n            controller.abort();\n        }, this._airtable._requestTimeout);\n        return new Promise(function (resolve, reject) {\n            fetch_1.default(url, requestOptions)\n                .then(function (resp) {\n                clearTimeout(timeout);\n                if (resp.status === 429 && !_this._airtable._noRetryIfRateLimited) {\n                    var numAttempts_1 = get_1.default(options, '_numAttempts', 0);\n                    var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts_1);\n                    setTimeout(function () {\n                        var newOptions = __assign(__assign({}, options), { _numAttempts: numAttempts_1 + 1 });\n                        _this.makeRequest(newOptions)\n                            .then(resolve)\n                            .catch(reject);\n                    }, backoffDelayMs);\n                }\n                else {\n                    resp.json()\n                        .then(function (body) {\n                        var err = _this._checkStatusForError(resp.status, body) ||\n                            _getErrorForNonObjectBody(resp.status, body);\n                        if (err) {\n                            reject(err);\n                        }\n                        else {\n                            resolve({\n                                statusCode: resp.status,\n                                headers: resp.headers,\n                                body: body,\n                            });\n                        }\n                    })\n                        .catch(function () {\n                        var err = _getErrorForNonObjectBody(resp.status);\n                        reject(err);\n                    });\n                }\n            })\n                .catch(function (err) {\n                clearTimeout(timeout);\n                err = new airtable_error_1.default('CONNECTION_ERROR', err.message, null);\n                reject(err);\n            });\n        });\n    };\n    /**\n     * @deprecated This method is deprecated.\n     */\n    Base.prototype.runAction = function (method, path, queryParams, bodyData, callback) {\n        run_action_1.default(this, method, path, queryParams, bodyData, callback, 0);\n    };\n    Base.prototype._getRequestHeaders = function (headers) {\n        var result = new http_headers_1.default();\n        result.set('Authorization', \"Bearer \" + this._airtable._apiKey);\n        result.set('User-Agent', userAgent);\n        result.set('Content-Type', 'application/json');\n        for (var _i = 0, _a = keys_1.default(headers); _i < _a.length; _i++) {\n            var headerKey = _a[_i];\n            result.set(headerKey, headers[headerKey]);\n        }\n        return result.toJSON();\n    };\n    Base.prototype._checkStatusForError = function (statusCode, body) {\n        var _a = (body !== null && body !== void 0 ? body : { error: {} }).error, error = _a === void 0 ? {} : _a;\n        var type = error.type, message = error.message;\n        if (statusCode === 401) {\n            return new airtable_error_1.default('AUTHENTICATION_REQUIRED', 'You should provide valid api key to perform this operation', statusCode);\n        }\n        else if (statusCode === 403) {\n            return new airtable_error_1.default('NOT_AUTHORIZED', 'You are not authorized to perform this operation', statusCode);\n        }\n        else if (statusCode === 404) {\n            return new airtable_error_1.default('NOT_FOUND', message !== null && message !== void 0 ? message : 'Could not find what you are looking for', statusCode);\n        }\n        else if (statusCode === 413) {\n            return new airtable_error_1.default('REQUEST_TOO_LARGE', 'Request body is too large', statusCode);\n        }\n        else if (statusCode === 422) {\n            return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNPROCESSABLE_ENTITY', message !== null && message !== void 0 ? message : 'The operation cannot be processed', statusCode);\n        }\n        else if (statusCode === 429) {\n            return new airtable_error_1.default('TOO_MANY_REQUESTS', 'You have made too many requests in a short period of time. Please retry your request later', statusCode);\n        }\n        else if (statusCode === 500) {\n            return new airtable_error_1.default('SERVER_ERROR', 'Try again. If the problem persists, contact support.', statusCode);\n        }\n        else if (statusCode === 503) {\n            return new airtable_error_1.default('SERVICE_UNAVAILABLE', 'The service is temporarily unavailable. Please retry shortly.', statusCode);\n        }\n        else if (statusCode >= 400) {\n            return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNEXPECTED_ERROR', message !== null && message !== void 0 ? message : 'An unexpected error occurred', statusCode);\n        }\n        else {\n            return null;\n        }\n    };\n    Base.prototype.doCall = function (tableName) {\n        return this.table(tableName);\n    };\n    Base.prototype.getId = function () {\n        return this._id;\n    };\n    Base.createFunctor = function (airtable, baseId) {\n        var base = new Base(airtable, baseId);\n        var baseFn = function (tableName) {\n            return base.doCall(tableName);\n        };\n        baseFn._base = base;\n        baseFn.table = base.table.bind(base);\n        baseFn.makeRequest = base.makeRequest.bind(base);\n        baseFn.runAction = base.runAction.bind(base);\n        baseFn.getId = base.getId.bind(base);\n        return baseFn;\n    };\n    return Base;\n}());\nfunction _canRequestMethodIncludeBody(method) {\n    return method !== 'GET' && method !== 'DELETE';\n}\nfunction _getErrorForNonObjectBody(statusCode, body) {\n    if (isPlainObject_1.default(body)) {\n        return null;\n    }\n    else {\n        return new airtable_error_1.default('UNEXPECTED_ERROR', 'The response from Airtable was invalid JSON. Please try again soon.', statusCode);\n    }\n}\nmodule.exports = Base;\n"]},"metadata":{},"sourceType":"script"}